<!-- created by ling on 2017-12-22 17:48. -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>canvas test</title>
    <style type="text/css">
        #canvas {
            border: 1px solid #000;
        }

        .thumb {
            width: 150px;
            height: 150px;
            margin: 0 10px 10px 10px;
        }
    </style>
</head>
<body>
<video src="v1.mp4" width="500" controls class="video">您的浏览器不支持video标签</video>
<video src="v1.mp4" width="500" controls class="video">您的浏览器不支持video标签</video>
<video src="v1.mp4" width="500" controls class="video">您的浏览器不支持video标签</video>
<video src="v1.mp4" width="500" controls class="video">您的浏览器不支持video标签</video>
<video src="v1.mp4" width="500" controls class="video">您的浏览器不支持video标签</video>
<video src="v1.mp4" width="500" controls class="video">您的浏览器不支持video标签</video>

<h1>截取图片在此</h1>

<script>


    var videos = document.querySelectorAll(".video");
    videos.forEach(function (val) {
        val.oncanplay = function () {
            videoToImg(val, genRandomNumber(5,val.duration), 0.1, genIMg);
        }
        // console.log(genRandomNumber(5,120));
    });


    /*
    * 截取视频某一帧
    * 参数：视频对象，截取的时间点，以秒为单位，图片质量
    * */
    function videoToImg(oVideo, timePoint, imgQuality, callback) {
        var genImgSrc = ''; //生成图片路径
        var videoSrc = oVideo.getAttribute('src');
        var videoWidth = 0;
        var videoHeight = 0;

        //生成一个视频对象
        var _oCanvas = document.createElement("canvas");
        var _context = _oCanvas.getContext('2d');
        var _oVideo = document.createElement("video");
        _oVideo.src = videoSrc;
        _oVideo.currentTime = timePoint;
        console.log(_oVideo);
        _oVideo.addEventListener("canplay", function () {
            console.log(1);
            videoWidth = _oVideo.videoWidth;
            videoHeight = _oVideo.videoHeight;
            _oVideo.width = _oCanvas.width = videoWidth;
            _oVideo.height = _oCanvas.height = videoHeight;

            console.log(videoWidth, videoHeight, _oVideo);
            //绘制
            _context.drawImage(_oVideo, 0, 0, videoWidth, videoHeight, 0, 0, videoWidth, videoHeight);
            // document.body.appendChild(_oCanvas);
            var dataURL = _oCanvas.toDataURL('image/jpeg', imgQuality);
            genImgSrc = dataURL;
            console.log("__图片已生成");

            //执行回调函数
            callback(genImgSrc)
        });
        return genImgSrc;
    }

    function genIMg(src) {
        var oImg = document.createElement("img");
        oImg.setAttribute("class", "thumb");
        oImg.src = src;
        oImg.onload = function (ev) {
            console.log("图片加载好了");
            document.body.appendChild(oImg);
        }
    }

    function genRandomNumber(minNumber, maxNumber) {
        var randomNumber = (Math.random() * maxNumber + minNumber) >> 0;
        return (randomNumber - minNumber > 0)?randomNumber:minNumber;
    }


</script>
</body>
</html>